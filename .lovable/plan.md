
# 新用户登录流程优化方案

## 需求概述

针对新用户 onboarding 流程，需要修复以下三个问题：

1. **验证码/密码切换**：新用户也能看到切换选项
2. **登录成功状态**：验证码通过后不显示"登录成功"，设置完密码后才显示
3. **设置密码页面布局**：调整为与登录页密码输入相似的左对齐布局

---

## 问题分析

### 问题 1：切换按钮对新用户隐藏

当前代码逻辑：
```text
hasPassword = true  → 显示切换按钮
hasPassword = false → 隐藏切换按钮（新用户看不到）
```

**解决思路**：对于新用户，虽然没有密码，但可以显示一个"使用密码登录"的入口，点击后提示需要先设置密码，或者直接引导到设置密码流程。

### 问题 2：新用户验证码后显示"登录成功"

当前流程：
```text
验证码通过 → 显示"登录成功" → 1.5秒后跳转到设置密码页
```

期望流程：
```text
验证码通过 → 直接跳转到设置密码页（不显示登录成功）
设置密码完成 → 显示"登录成功" → 进入onboarding
```

### 问题 3：SetPassword 页面居中布局

当前布局使用 `text-center` 和 `justify-center`，整体内容居中显示。

期望布局应该和 Login.tsx 的密码输入步骤保持一致：
- 标题和输入框左对齐
- 按钮固定在底部
- 移除居中对齐样式

---

## 技术方案

### 1. 修改 Login.tsx - 支持新用户看到切换选项

**文件**: `src/pages/Login.tsx`

**改动内容**:
- 修改切换按钮的显示条件，新用户也能看到
- 新用户点击"使用密码登录"时，提示需要先完成验证码登录后设置密码

**代码逻辑**:
```typescript
// 始终显示切换按钮，但新用户点击密码登录时给出提示
<div className="text-center mt-2">
  <button onClick={handleSwitchAuthMode}>
    {authMode === 'otp' ? '使用密码登录' : '使用验证码登录'}
  </button>
</div>

// 切换处理逻辑
const handleSwitchAuthMode = () => {
  if (!hasPassword && authMode === 'otp') {
    // 新用户想用密码登录，但没有密码
    // 可以显示提示，或直接保持OTP模式
    toast.info('请先完成验证码登录，设置密码后可使用密码登录');
    return;
  }
  // 正常切换逻辑...
};
```

### 2. 修改 Login.tsx - 新用户验证码通过后跳过成功状态

**文件**: `src/pages/Login.tsx`

**改动内容**:
- 修改 `handleVerifyCode` 函数
- 新用户验证码通过后，直接跳转到设置密码页，不显示 success 状态

**代码逻辑**:
```typescript
const handleVerifyCode = async (code: string) => {
  // ...验证逻辑
  
  const result = await verifyCode(identifier, code);
  saveLastLogin(loginMethod);
  
  // 新用户：跳过成功状态，直接进入设置密码
  if (result.userType === 'new') {
    navigate('/set-password?onboarding=true');
    return;
  }
  
  // 老用户：显示登录成功状态
  setLoginResult(result);
  setLoginStep('success');
  
  setTimeout(() => {
    if (result.hasExistingWallets) {
      navigate('/home');
    } else {
      navigate('/create-wallet');
    }
  }, 1500);
};
```

### 3. 修改 SetPassword.tsx - 调整布局风格

**文件**: `src/pages/SetPassword.tsx`

**改动内容**:
- 移除整体居中布局
- 标题和输入框改为左对齐
- 保持图标居中显示（与 Login 页面一致）
- 按钮区域固定在底部
- 成功状态显示改为"登录成功"（因为这是新用户流程的最后认证步骤）

**布局调整**:
```text
当前:                        改为:
┌─────────────────┐         ┌─────────────────┐
│                 │         │  ← 返回         │
│    [🔒 图标]     │         │                 │
│                 │         │    [🔒 图标]     │
│  设置登录密码    │         │                 │
│  居中描述文字    │         │ 设置登录密码     │ ← 左对齐
│                 │         │ 描述文字         │ ← 左对齐
│  [密码输入框]    │         │                 │
│  [确认输入框]    │         │ [密码输入框]     │
│                 │         │ [确认输入框]     │
│   [设置密码]     │         │                 │
│                 │         │                 │
└─────────────────┘         │   [设置密码]     │ ← 底部固定
                            └─────────────────┘
```

**成功状态文案调整**:
- 标题: "密码设置成功" → "登录成功"  
- 描述: "正在进入下一步..." → "正在进入创建钱包..."

---

## 文件改动清单

| 文件 | 改动类型 | 改动说明 |
|------|----------|----------|
| `src/pages/Login.tsx` | 修改 | 1. 切换按钮始终显示，新用户点击密码登录时提示<br>2. 新用户验证码通过后直接跳转，不显示成功状态 |
| `src/pages/SetPassword.tsx` | 修改 | 1. 调整布局为左对齐风格<br>2. 成功状态文案改为"登录成功" |

---

## 用户体验流程对比

### 改动前

```text
新用户验证码登录:
输入验证码 → 显示"登录成功" → 1.5秒 → 设置密码页 → 设置成功 → onboarding
```

### 改动后

```text
新用户验证码登录:
输入验证码 → 直接进入设置密码页 → 设置成功显示"登录成功" → onboarding
```

---

## 细节说明

### 关于切换按钮的显示策略

有两种方案可选：

**方案 A（推荐）**：始终显示切换按钮
- 新用户看到"使用密码登录"，点击后提示"请先完成验证登录并设置密码"
- 保持 UI 一致性

**方案 B**：新用户不显示切换按钮
- 保持现有逻辑
- 新用户完成 onboarding 后再回来登录时自然会看到切换按钮

建议采用方案 A，保持界面一致性。
